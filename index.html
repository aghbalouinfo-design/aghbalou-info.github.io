<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CS-Lycee</title>

    <!-- CONFIGURATION DU FAVICON (maintenue) -->
    <link rel="icon" type="image/png" href="https://aghbalouinfo-design.github.io/aghbalou-info.github.io/cyberpunk-me.png">
    <link rel="apple-touch-icon" href="https://aghbalouinfo-design.github.io/aghbalou-info.github.io/cyberpunk-me.png">
    
    <!-- Chargement de Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        /* Importation de la police Inter */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6; /* Fond très léger, harmonieux */
        }

        /* --- Couleurs de Thème et de Module (Vives) --- */
        /* Couleur de Marque (Navigation/Accentuation) */
        .gradient-theme {
            /* Dégradé Vert-Bleu (Teal Vif vers Cyan Profond) */
            background-image: linear-gradient(to right, #20c997, #17a2b8); 
        }

        /* Couleurs Primaires pour chaque Module */
        .bg-module-m01 { background-image: linear-gradient(to right, #2563eb, #3b82f6); } /* Bleu Vif */
        .bg-module-m02 { background-image: linear-gradient(to right, #059669, #10b981); } /* Vert Émeraude */
        .bg-module-m03 { background-image: linear-gradient(to right, #4f46e5, #6366f1); } /* Indigo Profond */
        .bg-module-m04 { background-image: linear-gradient(to right, #dc2626, #ef4444); } /* Rouge Alerte/Archive */


        /* --- Hiérarchie Visuelle (Opacité et Estompage) --- */
        .module-card-active {
            opacity: 1; /* En cours */
        }
        .module-card-completed {
            opacity: 0.75; /* Terminé/Archivé */
        }
        .module-card-upcoming {
            opacity: 0.60; /* À venir (grisé) */
            filter: grayscale(20%); /* Léger grisonnement */
        }


        /* --- Effets Généraux --- */
        .module-card {
            transition: transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out, opacity 0.3s;
        }

        .module-card:hover:not(.module-card-upcoming) {
            transform: translateY(-4px);
            box-shadow: 0 12px 25px rgba(0, 0, 0, 0.2);
            opacity: 1 !important; /* L'opacité remonte au survol */
        }
        .module-card:hover.module-card-upcoming {
             box-shadow: 0 6px 15px rgba(0, 0, 0, 0.1);
        }

        /* Amélioration Mobile */
        @media (max-width: 768px) {
            .nav-links li a {
                padding: 10px 12px;
                font-size: 1rem;
            }
            .info-card {
                margin-bottom: 24px;
            }
            .sequence-heading {
                font-size: 1.25rem;
            }
        }
        
        /* Accordéon des modules */
        .card-body {
            max-height: 500px;
            overflow: hidden;
            transition: max-height 0.5s ease-in-out;
            padding-top: 16px; 
        }

        .collapsed .card-body {
            max-height: 0;
            padding-top: 0;
        }

        /* Style pour les sections de la page de leçon */
        .lesson-section {
            border-left: 4px solid #17a2b8;
            padding-left: 1.5rem;
            margin-bottom: 2rem;
        }
        .lesson-section h3 {
            color: #17a2b8;
            border-bottom: 2px solid #e2e8f0;
            padding-bottom: 0.5rem;
            margin-bottom: 1rem;
        }

        /* --- Styles pour les NOTES DÉTAILLÉES --- */

        /* Cacher le marqueur natif */
        details summary {
            list-style: none;
        }
        details summary::-webkit-details-marker {
            display: none;
        }
        
        /* Rotation de l'icône pour la section DÉTAILS */
        .notes-summary-icon {
            /* Commence par pointer vers la droite (fermée) */
            transform: rotate(-90deg); 
            transition: transform 0.3s ease;
        }

        details[open] .notes-summary-icon {
            /* Pointe vers le bas (ouverte) */
            transform: rotate(0deg); 
        }

        /* Style Modal (Maintenue pour la réutilisation mais cachée pour la Leçon 1) */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 50;
        }
        .modal-content {
            background-color: white;
            max-width: 90%;
            max-height: 90%;
            overflow-y: auto;
            border-radius: 1rem;
            position: relative;
        }
        
    </style>
</head>
<body>

    <!-- Conteneur principal -->
    <div id="app" class="min-h-screen">
        
        <!-- Navigation -->
        <nav class="bg-white shadow-md sticky top-0 z-10">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between items-center h-16">
                    <!-- Titre du site Info-Aghbalou, cliquable pour retourner à l'accueil -->
                    <a href="#" onclick="navigateTo('accueil')" class="flex-shrink-0 text-2xl font-bold gradient-theme bg-clip-text text-transparent">
                        CS-Lycée
                    </a>
                    <div class="flex space-x-4 nav-links">
                        <a href="#" onclick="navigateTo('accueil')" class="text-gray-700 hover:text-gray-900 px-3 py-2 rounded-md font-medium" id="nav-accueil">Accueil</a>
                        <a href="#" onclick="navigateTo('modules')" class="text-gray-700 hover:text-gray-900 px-3 py-2 rounded-md font-medium" id="nav-modules">Modules</a>
                        <a href="#" onclick="navigateTo('ressources')" class="text-gray-700 hover:text-gray-900 px-3 py-2 rounded-md font-medium" id="nav-ressources">Ressources</a>
                        <a href="#" onclick="navigateTo('calendrier')" class="text-gray-700 hover:text-gray-900 px-3 py-2 rounded-md font-medium" id="nav-calendrier">Calendrier</a>
                        <a href="#" onclick="navigateTo('devoirs')" class="text-gray-700 hover:text-gray-900 px-3 py-2 rounded-md font-medium" id="nav-devoirs">Devoirs</a>
                        <a href="#" onclick="navigateTo('contact')" class="text-gray-700 hover:text-gray-900 px-3 py-2 rounded-md font-medium" id="nav-contact">Contact</a>
                    </div>
                </div>
            </div>
        </nav>

        <!-- Contenu de la Page -->
        <main class="max-w-7xl mx-auto py-8 px-4 sm:px-6 lg:px-8" id="page-content-container">
            <!-- Le contenu de la page sera injecté ici par JavaScript -->
        </main>

        <!-- Modale de Carte Mentale (Maintenue pour la réutilisation mais cachée pour la Leçon 1) -->
        <div id="mindmap-modal" class="modal-overlay hidden" onclick="closeMindMap()">
            <div class="modal-content p-8 w-11/12 md:w-3/4 lg:w-2/3" onclick="event.stopPropagation()">
                <button onclick="closeMindMap()" class="absolute top-4 right-4 text-gray-500 hover:text-gray-800 text-2xl font-bold">
                    &times;
                </button>
                <div id="mindmap-content">
                    <!-- Le contenu de la carte mentale interne sera injecté ici -->
                    <p class="text-center text-gray-500">Contenu de la carte mentale interne.</p>
                </div>
            </div>
        </div>


        <!-- Footer -->
        <footer class="bg-gray-100 mt-12 py-6 text-center text-gray-600 text-sm">
            <p>&copy; 2024 Hub Pédagogique Informatique. Développé par <span class="font-bold">Younes TICHOUA</span>.</p>
            <p>Version 3.1 | <a href="#" onclick="navigateTo('accueil')" class="text-teal-600 hover:text-teal-800">Retour à l'accueil</a></p>
        </footer>
    </div>

    <!-- Script JavaScript -->
    <script>
        // Global
        let currentView = 'accueil';

        // Variables Firestore (même si non utilisées dans ce fichier, elles doivent être définies)
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        
        // URL EXTERNE POUR LA CARTE MENTALE DE LA LEÇON 1
        const EXTERNAL_MINDMAP_URL = 'https://aghbalouinfo-design.github.io/aghbalou-info.github.io/Mindmap.html';
        // URL de la photo de l'enseignant, utilisée dans la page Contact
        const TEACHER_PHOTO_URL = 'https://aghbalouinfo-design.github.io/aghbalou-info.github.io/cyberpunk-me.png';


        // Icônes SVG pour les ressources
        const icons = {
            document: `<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-indigo-500" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4zm5 2a1 1 0 011-1h2a1 1 0 110 2h-2a1 1 0 01-1-1zm1 3a1 1 0 00-1 1v5a1 1 0 102 0v-5a1 1 0 00-1-1z" clip-rule="evenodd" /></svg>`,
            video: `<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-red-500" viewBox="0 0 20 20" fill="currentColor"><path d="M2 6a2 2 0 012-2h6a2 2 0 012 2v8a2 2 0 01-2 2H4a2 2 0 01-2-2V6zM14.553 7.106A1 1 0 0115 8v4a1 1 0 01-.447.894L11 15.618V6.382l3.553.724z" /></svg>`,
            app: `<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-green-500" viewBox="0 0 20 20" fill="currentColor"><path d="M10 2a6 6 0 00-6 6v2a1 1 0 001 1h6a1 1 0 001-1V8a6 6 0 00-6-6zM4 14v1a3 3 0 003 3h6a3 3 0 003-3v-1a1 1 0 00-1-1H5a1 1 0 00-1 1z" /></svg>`,
            pdf: `<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-red-600" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4zm2 10a1 1 0 011-1h6a1 1 0 110 2H7a1 1 0 01-1-1zm0-3a1 1 0 011-1h6a1 1 0 110 2H7a1 1 0 01-1-1zm0-3a1 1 0 011-1h6a1 1 0 110 2H7a1 1 0 01-1-1z" clip-rule="evenodd" /></svg>`,
            // Caret pour les accordéons (pointe vers le bas)
            caret: `<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 transform transition-transform" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" /></svg>`,
            // COCHE VERTE DE SUCCÈS pour les modules terminés
            checkPro: `<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7" /></svg>`,
        };


        // --- Données Structurées des Leçons (avec Ressources et MindMap) ---
        const lessonData = {
            'sequence01': {
                title: "Leçon 1 : Information, traitement et Informatique",
                moduleTitle: "M01 : Généralités sur les Systèmes Informatiques",
                overview: "Cette leçon explore le cycle fondamental de l'informatique : de la donnée brute à l'information significative (le cycle IPO), en passant par l'étape cruciale du traitement. Nous abordons la notion de digitalisation (analogique/numérique).",
                objectives: [
                    "Comprendre la différence fondamentale entre une donnée et une information (cycle IPO).",
                    "Identifier les composants de base d'une chaîne de traitement numérique.",
                    "Être capable d'expliquer le processus d'échantillonnage et de quantification."
                ],
                successCriteria: [
                    "Je peux donner au moins trois exemples d'applications de l'IA que j'utilise.", 
                    "Je peux schématiser le cycle de traitement de l'information.",
                    "J'utilise correctement le vocabulaire technique (Donnée, Traitement, Information, Analogique, Numérique)."
                ],
                // NOTES DE COURS DÉTAILLÉES (avec balises <strong>)
                detailedNotes: `
                    <h4 class="text-xl font-bold text-teal-800 mb-3">1. Le Cycle IPO (Input-Process-Output)</h4>
                    <p class="mb-4 text-gray-700">Le cœur de l'informatique repose sur ce modèle :</p>
                    <ul class="list-disc list-inside space-y-2 text-gray-700 ml-4">
                        <li><strong class="font-medium">Input (Entrée) :</strong> Ce sont les <strong class="font-medium">données brutes</strong> (clics de souris, texte tapé, image scannée) qui sont capturées. C'est la matière première.</li>
                        <li><strong class="font-medium">Process (Traitement) :</strong> C'est l'exécution des instructions (<strong class="font-medium">algorithmes</strong>) par le CPU pour transformer les données. C'est ici que l'information prend forme.</li>
                        <li><strong class="font-medium">Output (Sortie) :</strong> C'est le résultat transformé, c'est-à-dire l'<strong class="font-medium">information</strong> (un graphique, un document imprimé, un son joué). C'est le résultat utilisable.</li>
                    </ul>

                    <h4 class="text-xl font-bold text-teal-800 mt-6 mb-3">2. Digitalisation et Binaire</h4>
                    <p class="mb-4 text-gray-700">Un ordinateur ne comprend que le système binaire (0 et 1). Pour traiter des signaux du monde réel (son, image), il doit les <strong class="font-medium">digitaliser</strong> (rendre numériques) :</p>
                    <ul class="list-disc list-inside space-y-2 text-gray-700 ml-4">
                        <li><strong class="font-medium">Signal Analogique :</strong> Continu dans le temps et en valeur (ex: le son d'une voix, la lumière naturelle).</li>
                        <li><strong class="font-medium">Signal Numérique :</strong> Discret (interrompu) dans le temps et en valeur. Composé uniquement de 0 et de 1 (bits).</li>
                        <li><strong class="font-medium">Processus :</strong> Il nécessite l'<strong class="font-medium">Échantillonnage</strong> (prise de mesures régulières) et la <strong class="font-medium">Quantification</strong> (attribution d'une valeur binaire à chaque mesure).</li>
                    </ul>
                `,
                resourcesAndActivities: [
                    { type: "Worksheet", title: "Fiche d'identification des termes clés (analogique/numérique, binarisation, etc.)", objective: "Vocabulaire et Mémorisation", link: "fiche_vocabulaire_L1.pdf", icon: "document" },
                    { type: "Fiche Exercice", title: "Conversion binaire simple (niveau débutant)", objective: "Application pratique", link: "exercice_binaire_L1.pdf", icon: "document" },
                    { type: "Fiche Tuto", title: "Tuto : Comment visualiser le codage binaire sur un tableur (Excel/Sheets)", objective: "Développement d'une compétence numérique", link: "tuto_codage_excel_L1.pdf", icon: "video" },
                    { type: "Application", title: "Jeu interactif de QCM pour valider les acquis (App Web)", objective: "Auto-évaluation ludique", link: "#", icon: "app" },
                ],
                quiz: [
                    { id: 1, question: "Vrai ou Faux : Une donnée est toujours binaire (0 ou 1).", answer: "Vrai", explanation: "Toutes les données doivent être converties en format binaire pour être traitées par un ordinateur." },
                    { id: 2, question: "Quel est l'élément qui exécute le Traitement (Process) ?", answer: "Le CPU", explanation: "L'Unité Centrale de Traitement (CPU) est le 'cerveau' qui exécute les instructions de l'algorithme." },
                    { id: 3, question: "L'acronyme IPO signifie :", options: ["Input-Process-Output", "Information-Programme-Ordre", "Initialisation-Procédure-Opération"], answer: "Input-Process-Output", explanation: "C'est le modèle de base du fonctionnement informatique." }
                ],
                koLink: { 
                    url: "https://example.com/ko_m01_l01.pdf", 
                    label: "Télécharger l'Organisateur de Connaissances (KO - PDF)" 
                },
                mindMapUrl: EXTERNAL_MINDMAP_URL
            },
            
            // Autres leçons simplifiées
            'sequence01-L2': { 
                title: "Leçon 2 : Système informatique, Représentation de l'information",
                moduleTitle: "M01 : Généralités sur les Systèmes Informatiques",
                overview: "Introduction au système binaire et distinction fondamentale entre le matériel (hardware) et le logiciel (software).",
                objectives: ["Comprendre la nécessité du système binaire.", "Distinguer le hardware du software."],
                successCriteria: ["Je peux expliquer pourquoi les ordinateurs utilisent le binaire."],
                resourcesAndActivities: [], 
                quiz: [],
                koLink: { url: "https://example.com/ko_m01_l02.pdf", label: "Télécharger l'Organisateur de Connaissances (KO - PDF)" },
                mindMapUrl: null, // Pas de carte mentale pour cette leçon
                detailedNotes: `<p class="text-gray-600">Les notes détaillées pour cette leçon sont en cours de rédaction. Revenez bientôt !</p>`
            },
            'sequence02-L2': { 
                title: "Leçon 2 : Schéma fonctionnel d’un ordinateur",
                moduleTitle: "M01 : Généralités sur les Systèmes Informatiques",
                overview: "Exploration des composants internes et de leur rôle dans l'architecture de Von Neumann.",
                objectives: ["Dessiner et étiqueter le schéma fonctionnel.", "Expliquer le rôle de l'UAL et de l'UC."],
                successCriteria: ["Je peux identifier 4 composants principaux de l'UC."],
                resourcesAndActivities: [], 
                quiz: [],
                koLink: { url: "https://example.com/ko_m01_l03.pdf", label: "Télécharger l'Organisateur de Connaissances (KO - PDF)" },
                mindMapUrl: null, // Pas de carte mentale pour cette leçon
                detailedNotes: `<p class="text-gray-600">Les notes détaillées pour cette leçon sont en cours de rédaction. Revenez bientôt !</p>`
            }
        };

        // --- Fonctions de la Modale Carte Mentale (Maintenues mais inutilisées pour Leçon 1) ---
        window.closeMindMap = function() {
            document.getElementById('mindmap-modal').classList.add('hidden');
        }

        /**
         * Ouvre la carte mentale. Utilise l'URL externe si définie, sinon affiche une alerte.
         */
        window.openMindMap = function(lessonKey) {
            const mindMapUrl = lessonData[lessonKey]?.mindMapUrl;

            if (mindMapUrl) {
                // Ouvre le lien externe dans une nouvelle fenêtre
                window.open(mindMapUrl, '_blank');
            } else {
                // Utilisation d'un message non-critique pour respecter les contraintes
                console.log("Carte Mentale non disponible pour cette leçon.");
            }
        }

        /**
         * Gère la soumission simulée du formulaire de contact.
         */
        window.handleContactSubmit = function(event) {
            event.preventDefault();
            
            const formContainer = document.getElementById('contact-form-container');
            
            // Empêcher les soumissions multiples
            if (document.getElementById('success-message')) return; 

            // Création du message de succès
            const successMessage = document.createElement('div');
            successMessage.id = 'success-message';
            successMessage.className = 'mt-4 p-3 bg-green-100 border border-green-400 text-green-700 rounded-lg text-center font-medium';
            successMessage.textContent = '✅ Message envoyé ! Je vous répondrai dans les plus brefs délais.';
            formContainer.appendChild(successMessage);
            
            // Vider les champs
            document.getElementById('contact-subject').value = '';
            document.getElementById('contact-message').value = '';

            // Retirer le message après 4 secondes
            setTimeout(() => {
                successMessage.remove();
            }, 4000);

            console.log("Simulated form submission successful.");
        }


        /**
         * Génère la page de cours détaillée à partir des données structurées.
         */
        function generateLessonPage(lessonKey) {
            const data = lessonData[lessonKey];
            if (!data) return `<div class="p-8 text-center text-gray-600">Leçon non trouvée : ${lessonKey}</div>`;

            // Fonction de vérification de réponse au quiz
            function checkAnswer(id, correctAnswer, explanation, isQCM) {
                const feedbackElement = document.getElementById(`feedback-${id}`);
                let isCorrect = false;
                let userAnswer = '';
                
                // Logique de vérification (inchangée)
                if (isQCM) {
                    const checkedRadio = document.querySelector(`input[name="q-${id}"]:checked`);
                    userAnswer = checkedRadio ? checkedRadio.value : '';
                    isCorrect = userAnswer === correctAnswer;
                } else {
                    const input = document.querySelector(`#input-q-${id}`);
                    userAnswer = input ? input.value.trim() : '';
                    isCorrect = userAnswer.toLowerCase() === correctAnswer.toLowerCase();
                }

                feedbackElement.classList.remove('hidden', 'text-green-600', 'text-red-600');
                
                if (isCorrect) {
                    feedbackElement.classList.add('text-green-600');
                    feedbackElement.innerHTML = `✅ Correct ! ${explanation}`;
                } else {
                    feedbackElement.classList.add('text-red-600');
                    feedbackElement.innerHTML = `❌ Incorrect. Réponse attendue : "${correctAnswer}". Explication : ${explanation}`;
                }
            }
            window.checkAnswer = checkAnswer; // Rendre la fonction accessible globalement

            // Fonction pour générer le contenu du quiz
            const quizHtml = data.quiz && data.quiz.length > 0 ? data.quiz.map(q => {
                const isQCM = q.options && q.options.length > 0;
                let answerDisplay = '';

                if (isQCM) {
                    answerDisplay = q.options.map((opt, index) => `
                        <div class="flex items-center mt-1">
                            <input type="radio" name="q-${q.id}" id="q-${q.id}-${index}" value="${opt}" class="mr-2 accent-teal-600">
                            <label for="q-${q.id}-${index}">${opt}</label>
                        </div>
                    `).join('');
                } else {
                    answerDisplay = `<input type="text" id="input-q-${q.id}" placeholder="Entrez votre réponse..." class="p-2 border rounded w-full mt-2 focus:ring-teal-500 focus:border-teal-500">`;
                }

                return `
                    <div class="bg-white p-5 rounded-lg shadow-sm border border-gray-200 mb-6">
                        <p class="font-semibold text-gray-800 mb-3">${q.id}. ${q.question}</p>
                        ${answerDisplay}
                        <div id="feedback-${q.id}" class="mt-3 text-sm font-medium hidden"></div>
                        <button onclick="checkAnswer(${q.id}, '${q.answer.replace(/'/g, "\\'")}', '${q.explanation.replace(/'/g, "\\'")}', ${isQCM})" 
                                class="mt-3 text-sm px-3 py-1 bg-teal-500 text-white rounded hover:bg-teal-600 transition">
                            Vérifier
                        </button>
                    </div>
                `;
            }).join('') : '<p class="text-gray-500">Pas de quiz pour cette leçon pour l\'instant.</p>';

            // LOGIQUE KO (Organisateur de Connaissances)
            const koLinkData = data.koLink;
            let knowledgeOrganizerHtml;

            if (koLinkData) {
                knowledgeOrganizerHtml = `
                    <p class="mb-4 text-gray-700">L'organisateur de connaissances (KO) est disponible au format PDF pour une consultation hors ligne. Cliquez sur le bouton ci-dessous pour le télécharger.</p>
                    <a href="${koLinkData.url}" target="_blank" class="w-full inline-flex justify-center items-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 transition duration-150">
                        ${icons.pdf}
                        ${koLinkData.label}
                    </a>
                `;
            } else {
                knowledgeOrganizerHtml = `<p class="text-gray-500">Pas de KO disponible pour cette leçon.</p>`;
            }

            // LOGIQUE NOUVELLE SECTION : Ressources et Activités
            const resourcesHtml = data.resourcesAndActivities && data.resourcesAndActivities.length > 0 ? data.resourcesAndActivities.map(res => {
                const iconSvg = icons[res.icon] || icons.document;
                const linkTarget = res.link.startsWith('http') || res.link.endsWith('.pdf') ? '_blank' : '#';
                const linkElement = res.link.startsWith('#') 
                    ? `<span class="text-gray-600">${res.link.replace('#', '')}</span>`
                    : `<a href="${res.link}" target="${linkTarget}" class="font-semibold text-teal-600 hover:text-teal-800 transition duration-150 truncate">${res.link}</a>`;

                return `
                    <li class="grid grid-cols-1 md:grid-cols-12 gap-2 p-3 border-l-4 border-teal-300 bg-gray-50 rounded-lg hover:bg-gray-100 transition duration-150">
                        <div class="md:col-span-1 flex items-center space-x-2">
                           ${iconSvg}
                           <span class="font-bold text-sm text-gray-700">${res.type}</span>
                        </div>
                        <div class="md:col-span-6 text-gray-800">
                           ${res.title}
                        </div>
                        <div class="md:col-span-3 text-sm text-gray-600 italic">
                            ${res.objective}
                        </div>
                        <div class="md:col-span-2 text-sm text-right">
                           ${linkElement}
                        </div>
                    </li>
                `;
            }).join('') : '<p class="text-gray-500">Aucune ressource ou activité spécifique pour cette leçon pour l\'instant.</p>';

            // LOGIQUE CARTE MENTALE (pointe maintenant vers l'URL externe)
            const mindMapButtonHtml = data.mindMapUrl 
                ? `<button onclick="openMindMap('${lessonKey}')" class="w-full inline-flex justify-center items-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-150">
                        <svg xmlns="http://www.w3.org/2000/svg" class="-ml-1 mr-3 h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M11.49 3.17c-.38-1.56-2.6-1.56-2.98 0a1.532 1.532 0 01-2.286.948c-1.3-.873-2.886.6-2.188 1.961a1.532 1.532 0 01-.582 2.286c-1.56.38-1.56 2.6 0 2.98a1.532 1.532 0 01.582 2.286c-.873 1.3.6 2.886 1.961 2.188a1.532 1.532 0 012.286.582c.38 1.56 2.6 1.56 2.98 0a1.532 1.532 0 012.286-.582c1.3.873 2.886-.6 2.188-1.961a1.532 1.532 0 01.582-2.286c1.56-.38 1.56-2.6 0-2.98a1.532 1.532 0 01-.582-2.286c.873-1.3-.6-2.886-1.961-2.188a1.532 1.532 0 01-2.286-.582zM10 8a2 2 0 100 4 2 2 0 000-4z" clip-rule="evenodd" /></svg>
                        Ouvrir la Carte Mentale (Lien Externe)
                    </button>`
                : `<div class="w-full px-6 py-3 text-center bg-gray-300 text-gray-700 rounded-lg font-semibold shadow-md">🧠 Carte Mentale non disponible</div>`;
                
            // LOGIQUE POUR LES NOTES DÉTAILLÉES 
            const detailedNotesHtml = data.detailedNotes ? `
                <div class="bg-indigo-50 p-6 rounded-xl shadow-xl border border-indigo-200 border-l-8 border-indigo-500">
                    <details class="cursor-pointer">
                        <summary class="text-3xl font-extrabold text-indigo-800 hover:text-indigo-900 transition duration-150 py-1 flex items-center">
                            <!-- L'icône change de direction via le CSS .notes-summary-icon -->
                            <span class="notes-summary-icon mr-2">${icons.caret}</span>
                            <span>Notes de Cours Détaillées (Version Web)</span>
                        </summary>
                        <div class="mt-4 pt-4 border-t border-indigo-200">
                            ${data.detailedNotes}
                        </div>
                    </details>
                </div>
            ` : '';



            return `
                <!-- BOUTON DE RETOUR ARRIÈRE -->
                <button onclick="navigateTo('modules')" class="mb-6 inline-flex items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-teal-500">
                    ← Revenir aux Modules
                </button>
                
                <h1 class="text-4xl font-extrabold text-gray-800 mb-2">${data.moduleTitle}</h1>
                <h2 class="text-3xl font-bold gradient-theme bg-clip-text text-transparent mb-8">${data.title}</h2>
                
                <div class="space-y-10">
                    
                    <!-- 1. APERÇU -->
                    <div class="bg-white p-6 rounded-xl shadow-lg">
                        <h3 class="text-2xl font-bold text-teal-700 mb-4">Aperçu du cours</h3>
                        <p class="text-gray-700">${data.overview}</p>
                    </div>

                    <!-- 2. OBJECTIFS & CRITÈRES DE RÉUSSITE -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                        <!-- 2.1. OBJECTIFS -->
                        <div class="bg-white p-6 rounded-xl shadow-lg lesson-section">
                            <h3 class="text-xl font-bold">Objectifs Pédagogiques</h3>
                            <ul class="list-disc list-inside space-y-2 text-gray-700">
                                ${data.objectives.map(obj => `<li>${obj}</li>`).join('')}
                            </ul>
                        </div>

                        <!-- 2.2. CRITÈRES DE RÉUSSITE -->
                        <div class="bg-white p-6 rounded-xl shadow-lg lesson-section" style="border-left-color: #20c997;">
                            <h3 class="text-xl font-bold" style="color: #20c997;">Critères de Réussite ("Je peux...")</h3>
                            <ul class="list-disc list-inside space-y-2 text-gray-700">
                                ${data.successCriteria.map(crit => `<li>${crit}</li>`).join('')}
                            </ul>
                        </div>
                    </div>
                    
                    <!-- 3. RESSOURCES ET ACTIVITÉS -->
                    <div class="bg-white p-6 rounded-xl shadow-lg">
                        <h3 class="text-2xl font-bold text-teal-700 mb-4 border-b pb-2">Ressources et Activités</h3>
                        <p class="text-gray-600 mb-4">Feuilles d'exercices, tutoriels, vidéos et applications interactives pour approfondir la leçon.</p>
                        <ul class="space-y-3">
                            ${resourcesHtml}
                        </ul>
                    </div>

                    <!-- 4. QUIZ FORMATIF -->
                    <div class="bg-white p-6 rounded-xl shadow-lg">
                        <h3 class="text-2xl font-bold text-teal-700 mb-4 border-b pb-2">Quiz Formatif</h3>
                        ${quizHtml}
                    </div>
                    
                    <!-- 5. NOTES DE COURS DÉTAILLÉES (MAINTENANT TRÈS VISIBLE) -->
                    ${detailedNotesHtml}

                    <!-- 6. KNOWLEDGE ORGANIZER & CARTE MENTALE -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                        <!-- ORGANISATEUR DE CONNAISSANCES (KO) -->
                        <div class="bg-white p-6 rounded-xl shadow-lg">
                            <h3 class="text-2xl font-bold text-teal-700 mb-4 border-b pb-2">Organisateur de Connaissances (KO)</h3>
                            ${knowledgeOrganizerHtml}
                        </div>

                        <!-- CARTE MENTALE -->
                        <div class="bg-white p-6 rounded-xl shadow-lg flex flex-col justify-between">
                            <h3 class="text-2xl font-bold text-teal-700 mb-4 border-b pb-2">Visualisation de la Leçon (Carte Mentale)</h3>
                            <p class="text-gray-700 mb-4">Utilisez cet outil pour réviser et organiser visuellement les concepts clés de la leçon.</p>
                            ${mindMapButtonHtml}
                        </div>
                    </div>
                </div>
            `;
        }

        /**
         * Fonction utilitaire pour obtenir les classes basées sur le statut et l'ID du module.
         */
        function getModuleClasses(moduleId, status) {
            let colorClass, opacityClass, buttonClass, buttonText, buttonDisabled, statusTagClass;
            const isCurrent = status === "En cours";
            const isUpcoming = status === "À venir";
            const isCompleted = status === "Terminé";

            // 1. DÉFINITION DE LA COULEUR DU MODULE (Base)
            switch (moduleId) {
                case 1: colorClass = 'bg-module-m01'; break; // Bleu (Systèmes)
                case 2: colorClass = 'bg-module-m02'; break; // Vert (Logiciels)
                case 3: colorClass = 'bg-module-m03'; break; // Indigo (Prog)
                case 4: colorClass = 'bg-module-m04'; break; // Rouge (Réseaux)
                default: colorClass = 'bg-gray-500';
            }

            // 2. HIÉRARCHIE D'OPACITÉ ET DE BOUTON (Estompage)
            if (isCurrent) {
                opacityClass = 'module-card-active';
                buttonClass = 'bg-white text-gray-800 shadow-md hover:bg-gray-100';
                buttonText = 'Voir le module';
                buttonDisabled = false;
                statusTagClass = 'bg-white/30 text-white';
            } else if (isCompleted) {
                opacityClass = 'module-card-completed';
                buttonClass = 'bg-white/70 text-gray-800 hover:bg-white';
                buttonText = 'Revoir';
                buttonDisabled = false;
                statusTagClass = 'bg-white/30 text-white flex items-center space-x-1'; // Avec icône
            } else { // À venir
                opacityClass = 'module-card-upcoming';
                buttonClass = 'bg-gray-400 text-gray-700 cursor-not-allowed shadow-inner';
                buttonText = 'À venir';
                buttonDisabled = true;
                statusTagClass = 'bg-white/30 text-white';
            }
            
            // Le texte doit toujours être blanc pour un bon contraste avec les couleurs vives (même estompées)
            const headerClass = `${colorClass} text-white`;

            return { headerClass, opacityClass, statusTagClass, buttonClass, buttonText, buttonDisabled };
        }
        
        // --- Fonctions de Contenu des Pages (mise à jour de la page contact) ---
        const pageContent = {
            accueil: () => {
                // NOUVEAUX STATUTS COHÉRENTS
                const modulesForAccueil = [
                    { id: 1, title: "M01 : Généralités sur les Systèmes Informatiques", status: "En cours" },
                    { id: 2, title: "M02 : Les Logiciels", status: "À venir" },
                    { id: 3, title: "M03 : Algorithmique et Programmation", status: "À venir" },
                    { id: 4, title: "M04 : Réseaux et Internet", status: "Terminé" },
                ];

                const moduleCardsHtml = modulesForAccueil.map(module => {
                    const { headerClass, opacityClass, statusTagClass, buttonClass, buttonText, buttonDisabled } = getModuleClasses(module.id, module.status);

                    // Contenu du statut pour la carte d'accueil
                    let statusContent = `<p class="text-sm font-light">${module.status}</p>`;

                    // Remplacement du texte du statut par une icône si "Terminé"
                    let moduleStatusDisplay = module.status;
                    if (module.status === "Terminé") {
                        // Utilise l'icône de succès (checkPro) définie au début du script
                        moduleStatusDisplay = `<div class="flex items-center space-x-1">${icons.checkPro} Terminé</div>`;
                    }
                    
                    return `
                        <div class="module-card p-6 rounded-xl shadow-lg ${headerClass} ${opacityClass}">
                            <div class="text-white">
                                <h3 class="text-xl font-extrabold mb-1">${module.title}</h3>
                                ${statusContent}
                            </div>
                            <!-- Bouton qui ne navigue que s'il n'est pas "À venir" -->
                            <a href="${buttonDisabled ? '#' : 'javascript:void(0)'}" 
                                onclick="${buttonDisabled ? '' : "navigateTo('modules')"}"
                                class="inline-block mt-4 px-6 py-2 rounded-lg font-semibold transition duration-300 ${buttonClass}">
                                ${buttonText}
                            </a>
                        </div>
                    `;
                }).join('');


                return `
                    <div class="hero-banner gradient-theme text-white p-8 sm:p-12 rounded-2xl shadow-xl mb-10 text-center">
                        <h1 class="text-4xl sm:text-5xl font-extrabold mb-2">Bienvenue sur CS-Lycée</h1>
                        <p class="text-lg opacity-90">Votre plateforme interactive pour maîtriser les bases de l'informatique.</p>
                    </div>

                    <div class="mb-10 p-6 bg-white rounded-xl shadow-md border-l-4 border-red-500">
                        <p class="text-red-700">URGENT : Le Devoir 1 est à rendre avant ce vendredi. Consultez l'onglet "Devoirs" !</p>
                    </div>

                    <h2 class="text-3xl font-bold text-gray-800 mb-6 border-b pb-2">Mes Modules</h2>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                        ${moduleCardsHtml}
                    </div>
                `;
            },

            modules: () => {
                // NOUVELLE STRUCTURE UTILISANT UNIQUEMENT LE STATUT POUR LA COULEUR
                const modulesStructure = [
                    { 
                        id: 1, 
                        title: "M01 : Généralités sur les Systèmes Informatiques", 
                        status: "En cours", 
                        sequences: [
                            { title: "Séquence 1 : Définitions et vocabulaire de base", lessons: [
                                { title: "Leçon 1 : Information, traitement et Informatique", href: "sequence01" },
                                { title: "Leçon 2 : Système informatique, Représentation de l'information", href: "sequence01-L2" }
                            ]},
                            { title: "Séquence 2 : Structure de base d’un ordinateur", lessons: [
                                { title: "Leçon 1 : Ordinateur, Catégories des ordinateurs", href: "sequence02-L1" },
                                { title: "Leçon 2 : Schéma fonctionnel d’un ordinateur", href: "sequence02-L2" },
                                { title: "Leçon 3 : CPU et Mémoire centrale", href: "sequence02-L3" }
                            ]}
                        ]
                    },
                    { 
                        id: 2, 
                        title: "M02 : Les Logiciels", 
                        status: "À venir", 
                        sequences: [
                            { title: "Séquence 1 : Système d’exploitation", lessons: [
                                { title: "Leçon 1 : Fonctionnalités de base d’un système d’exploitation", href: "sequence02-S1-L1" },
                                { title: "Leçon 2 : Environnement d’un système d’exploitation", href: "sequence02-S1-L2" },
                                { title: "Leçon 3 : Gestion des fichiers et dossiers", href: "sequence02-S1-L3" }
                            ]},
                            { title: "Séquence 2 : Traitement de texte", lessons: [
                                { title: "Leçon 1 : Interface et outils de base", href: "sequence02-S2-L1" },
                                { title: "Leçon 2 : Élaboration d’un document", href: "sequence02-S2-L2" }
                            ]},
                            { title: "Séquence 3 : Tableur", lessons: [
                                { title: "Leçon 1 : Fonctionnalités d’un tableur", href: "sequence02-S3-L1" },
                                { title: "Leçon 2 : Création de tableaux", href: "sequence02-S3-L2" },
                                { title: "Leçon 3 : Réalisation de graphiques", href: "sequence02-S3-L3" }
                            ]}
                        ]
                    },
                    { 
                        id: 3, 
                        title: "M03 : Algorithmique et Programmation", 
                        status: "À venir", 
                        sequences: [
                            { title: "Séquence 1 : Algorithme et structures de contrôle", lessons: [
                                { title: "Leçon 1 : Notion d’algorithme", href: "sequence03-S1-L1" },
                                { title: "Leçon 2 : Instructions de base", href: "sequence03-S1-L2" },
                                { title: "Leçon 3 : Structures de contrôle (conditionnelles et répétitives)", href: "sequence03-S1-L3" }
                            ]},
                            { title: "Séquence 2 : Langage de programmation", lessons: [
                                { title: "Leçon 1 : Notion de programme", href: "sequence03-S2-L1" },
                                { title: "Leçon 2 : Langages de programmation", href: "sequence03-S2-L2" },
                                { title: "Leçon 3 : Transcription d’un algorithme en code", href: "sequence03-S2-L3" }
                            ]}
                        ]
                    },
                    { 
                        id: 4, 
                        title: "M04 : Réseaux et Internet", 
                        status: "Terminé", 
                        sequences: [
                            { title: "Séquence 1 : Notion de réseau informatique", lessons: [
                                { title: "Leçon 1 : Définition et utilité d’un réseau", href: "sequence04-S1-L1" },
                                { title: "Leçon 2 : Typologie des réseaux", href: "sequence04-S1-L2" },
                                { title: "Leçon 3 : Topologies des réseaux", href: "sequence04-S1-L3" }
                            ]},
                            { title: "Séquence 2 : Réseau Internet", lessons: [
                                { title: "Leçon 1 : Définition d’Internet", href: "sequence04-S2-L1" },
                                { title: "Leçon 2 : Services Internet (Web, e-mail, chat pédagogique)", href: "sequence04-S2-L2" },
                                { title: "Leçon 3 : Avantages et inconvénients d’Internet", href: "sequence04-S2-L3" }
                            ]}
                        ]
                    }
                ];

                return modulesStructure.map(module => {
                    const { headerClass, opacityClass, statusTagClass } = getModuleClasses(module.id, module.status);

                    const sequencesHtml = module.sequences.map(seq => `
                        <div class="mb-4 pt-3 border-t border-gray-100">
                            <h4 class="sequence-heading text-lg font-semibold text-gray-800 mb-2 p-1 rounded bg-gray-100">${seq.title}</h4>
                            <ul class="space-y-1 pl-4 text-gray-700">
                                ${seq.lessons.map(lesson => {
                                    // Les leçons d'un module "À venir" sont désactivées.
                                    const isDisabled = module.status !== "En cours" && module.status !== "Terminé";
                                    const linkClass = isDisabled ? 'text-gray-500 cursor-not-allowed' : 'text-gray-700 hover:text-teal-600';
                                    
                                    // CORRECTION : Utilisation de javascript:void(0) pour éviter le rechargement de la page 
                                    // et s'assurer que l'action onclick est bien appelée.
                                    const linkAction = isDisabled ? 'javascript:void(0)' : `MapsTo('${lesson.href}')`;
                                    
                                    return `
                                        <li class="pl-2 border-l-2 border-gray-300 hover:bg-gray-50 rounded">
                                            <a href="#" onclick="${linkAction}" class="block py-1 text-sm ${linkClass}">
                                                ${lesson.title}
                                            </a>
                                        </li>
                                    `;
                                }).join('')}
                            </ul>
                        </div>
                    `).join('');
                    
                    // Contenu du statut
                    let statusIconText = module.status;
                    if (module.status === "Terminé") {
                        statusIconText = `${icons.checkPro} Terminé`;
                    }

                    // Définir M01 (id=1) comme étant le module par défaut à déplier (car il est "En cours")
                    const isM1Active = module.id === 1;


                    return `
                        <div class="info-card module-card bg-white rounded-xl shadow-lg mb-6 ${!isM1Active ? 'collapsed' : ''} ${opacityClass}" id="module-${module.id}">
                            <div 
                                class="card-header ${headerClass} p-4 rounded-t-xl flex justify-between items-center cursor-pointer"
                                onclick="toggleModule(${module.id})"
                            >
                                <h3 class="text-xl font-extrabold text-white">${module.title}</h3>
                                <div class="flex items-center space-x-2">
                                    <span class="status-tag ${statusTagClass} text-xs font-semibold px-3 py-1 rounded-full text-white">${statusIconText}</span>
                                    <span class="toggle-icon text-lg text-white">${isM1Active ? '▼' : '▶'}</span>
                                </div>
                            </div>
                            <div class="card-body p-4 pt-0">
                                ${sequencesHtml}
                            </div>
                        </div>
                    `;
                }).join('');
            },

            // Remplacement des anciennes pages de séquence par un appel à la fonction générique
            'sequence01': () => generateLessonPage('sequence01'),
            'sequence01-L2': () => generateLessonPage('sequence01-L2'),
            'sequence02-L1': () => `<div class="p-8 text-center text-gray-600">Contenu pour M01-S02-L01 à venir... <button onclick="navigateTo('modules')" class="text-teal-600 hover:underline">Retour aux modules</button></div>`,
            'sequence02-L2': () => generateLessonPage('sequence02-L2'),
            'sequence02-L3': () => `<div class="p-8 text-center text-gray-600">Contenu pour M01-S02-L03 à venir... <button onclick="navigateTo('modules')" class="text-teal-600 hover:underline">Retour aux modules</button></div>`,
            'sequence02-S1-L1': () => `<div class="p-8 text-center text-gray-600">Contenu pour M02-S01-L01 à venir... <button onclick="navigateTo('modules')" class="text-teal-600 hover:underline">Retour aux modules</button></div>`,
            'sequence02-S1-L2': () => `<div class="p-8 text-center text-gray-600">Contenu pour M02-S01-L02 à venir... <button onclick="navigateTo('modules')" class="text-teal-600 hover:underline">Retour aux modules</button></div>`,
            'sequence02-S1-L3': () => `<div class="p-8 text-center text-gray-600">Contenu pour M02-S01-L03 à venir... <button onclick="navigateTo('modules')" class="text-teal-600 hover:underline">Retour aux modules</button></div>`,
            'sequence02-S2-L1': () => `<div class="p-8 text-center text-gray-600">Contenu pour M02-S02-L01 à venir... <button onclick="navigateTo('modules')" class="text-teal-600 hover:underline">Retour aux modules</button></div>`,
            'sequence02-S2-L2': () => `<div class="p-8 text-center text-gray-600">Contenu pour M02-S02-L02 à venir... <button onclick="navigateTo('modules')" class="text-teal-600 hover:underline">Retour aux modules</button></div>`,
            'sequence02-S3-L1': () => `<div class="p-8 text-center text-gray-600">Contenu pour M02-S03-L01 à venir... <button onclick="navigateTo('modules')" class="text-teal-600 hover:underline">Retour aux modules</button></div>`,
            'sequence02-S3-L2': () => `<div class="p-8 text-center text-gray-600">Contenu pour M02-S03-L02 à venir... <button onclick="navigateTo('modules')" class="text-teal-600 hover:underline">Retour aux modules</button></div>`,
            'sequence02-S3-L3': () => `<div class="p-8 text-center text-gray-600">Contenu pour M02-S03-L03 à venir... <button onclick="navigateTo('modules')" class="text-teal-600 hover:underline">Retour aux modules</button></div>`,
            'sequence03-S1-L1': () => `<div class="p-8 text-center text-gray-600">Contenu pour M03-S01-L01 à venir... <button onclick="navigateTo('modules')" class="text-teal-600 hover:underline">Retour aux modules</button></div>`,
            'sequence03-S1-L2': () => `<div class="p-8 text-center text-gray-600">Contenu pour M03-S01-L02 à venir... <button onclick="navigateTo('modules')" class="text-teal-600 hover:underline">Retour aux modules</button></div>`,
            'sequence03-S1-L3': () => `<div class="p-8 text-center text-gray-600">Contenu pour M03-S01-L03 à venir... <button onclick="navigateTo('modules')" class="text-teal-600 hover:underline">Retour aux modules</button></div>`,
            'sequence03-S2-L1': () => `<div class="p-8 text-center text-gray-600">Contenu pour M03-S02-L01 à venir... <button onclick="navigateTo('modules')" class="text-teal-600 hover:underline">Retour aux modules</button></div>`,
            'sequence03-S2-L2': () => `<div class="p-8 text-center text-gray-600">Contenu pour M03-S02-L02 à venir... <button onclick="navigateTo('modules')" class="text-teal-600 hover:underline">Retour aux modules</button></div>`,
            'sequence03-S2-L3': () => `<div class="p-8 text-center text-gray-600">Contenu pour M03-S02-L03 à venir... <button onclick="navigateTo('modules')" class="text-teal-600 hover:underline">Retour aux modules</button></div>`,
            'sequence04-S1-L1': () => `<div class="p-8 text-center text-gray-600">Contenu pour M04-S01-L01 à venir... <button onclick="navigateTo('modules')" class="text-teal-600 hover:underline">Retour aux modules</button></div>`,
            'sequence04-S1-L2': () => `<div class="p-8 text-center text-gray-600">Contenu pour M04-S01-L02 à venir... <button onclick="navigateTo('modules')" class="text-teal-600 hover:underline">Retour aux modules</button></div>`,
            'sequence04-S1-L3': () => `<div class="p-8 text-center text-gray-600">Contenu pour M04-S01-L03 à venir... <button onclick="navigateTo('modules')" class="text-teal-600 hover:underline">Retour aux modules</button></div>`,
            'sequence04-S2-L1': () => `<div class="p-8 text-center text-gray-600">Contenu pour M04-S02-L01 à venir... <button onclick="navigateTo('modules')" class="text-teal-600 hover:underline">Retour aux modules</button></div>`,
            'sequence04-S2-L2': () => `<div class="p-8 text-center text-gray-600">Contenu pour M04-S02-L02 à venir... <button onclick="navigateTo('modules')" class="text-teal-600 hover:underline">Retour aux modules</button></div>`,
            'sequence04-S2-L3': () => `<div class="p-8 text-center text-gray-600">Contenu pour M04-S02-L03 à venir... <button onclick="navigateTo('modules')" class="text-teal-600 hover:underline">Retour aux modules</button></div>`,

            devoirs: () => `
                <h2 class="text-3xl font-bold text-gray-800 mb-6 border-b pb-2">Mes Devoirs</h2>
                <div class="bg-white p-6 rounded-xl shadow-lg mb-6">
                    <h3 class="text-xl font-bold text-red-600 mb-3">Devoir 1: Cycle du Traitement de l'Information</h3>
                    <p class="text-gray-700 mb-4">Décrivez les étapes du cycle IPO avec un exemple concret de votre vie quotidienne. (500 mots max)</p>
                    <p class="text-sm font-semibold text-red-500">Date limite: Vendredi prochain (18:00)</p>
                </div>
                <div class="bg-white p-6 rounded-xl shadow-lg mb-6 opacity-70">
                    <h3 class="text-xl font-bold text-gray-500 mb-3">Devoir 2: Structure Binaire</h3>
                    <p class="text-gray-500 mb-4">Conversion de nombres décimaux en binaire (exercices).</p>
                    <p class="text-sm font-semibold text-gray-400">Statut: Non disponible</p>
                </div>
            `,

            ressources: () => `
                <h2 class="text-3xl font-bold text-gray-800 mb-6 border-b pb-2">Ressources Pédagogiques</h2>
                <div class="bg-white p-6 rounded-xl shadow-lg mb-6">
                    <h3 class="text-2xl font-bold text-teal-700 mb-4">Ressources Générales</h3>
                    <ul class="space-y-3">
                        <li class="p-3 border-l-4 border-teal-300 bg-gray-50 rounded-lg">
                            <a href="#" class="font-semibold text-gray-800 hover:text-teal-600">Lexique des termes informatiques</a> - Définitions clés pour tous les modules.
                        </li>
                        <li class="p-3 border-l-4 border-teal-300 bg-gray-50 rounded-lg">
                            <a href="#" class="font-semibold text-gray-800 hover:text-teal-600">Guide de préparation aux examens (PDF)</a> - Méthodes et conseils.
                        </li>
                    </ul>
                </div>
                <div class="bg-white p-6 rounded-xl shadow-lg">
                    <h3 class="text-2xl font-bold text-blue-700 mb-4">Ressources par Module</h3>
                    <ul class="space-y-3">
                        <li class="p-3 border-l-4 border-blue-300 bg-gray-50 rounded-lg">
                            <span class="font-bold text-blue-800">M01 (Systèmes) :</span> Vidéo explicative sur le rôle de la RAM.
                        </li>
                        <li class="p-3 border-l-4 border-blue-300 bg-gray-50 rounded-lg">
                            <span class="font-bold text-blue-800">M03 (Algorithmique) :</span> Exercices interactifs sur les boucles 'Pour' et 'Tant que'.
                        </li>
                    </ul>
                </div>
            `,
            
            calendrier: () => `
                <h2 class="text-3xl font-bold text-gray-800 mb-6 border-b pb-2">Calendrier des Événements</h2>
                <div class="bg-white p-6 rounded-xl shadow-lg">
                    <h3 class="text-2xl font-bold text-teal-700 mb-4">Prochains Événements</h3>
                    <div class="space-y-4">
                        <div class="p-4 border-l-4 border-red-500 bg-red-50 rounded-lg flex justify-between items-center">
                            <div>
                                <h4 class="font-bold text-red-800">Date limite : Devoir 1</h4>
                                <p class="text-sm text-red-600">M01 - Cycle IPO</p>
                            </div>
                            <span class="font-extrabold text-red-700">18 Octobre</span>
                        </div>
                        <div class="p-4 border-l-4 border-teal-500 bg-teal-50 rounded-lg flex justify-between items-center">
                            <div>
                                <h4 class="font-bold text-teal-800">Lancement du Module M02</h4>
                                <p class="text-sm text-teal-600">Logiciels et Systèmes d'exploitation</p>
                            </div>
                            <span class="font-extrabold text-teal-700">25 Octobre</span>
                        </div>
                        <div class="p-4 border-l-4 border-gray-500 bg-gray-50 rounded-lg flex justify-between items-center opacity-70">
                            <div>
                                <h4 class="font-bold text-gray-800">Examen final du Module M01</h4>
                                <p class="text-sm text-gray-600">Révision complète</p>
                            </div>
                            <span class="font-extrabold text-gray-700">8 Novembre</span>
                        </div>
                    </div>
                </div>
            `,

            contact: () => `
                <h2 class="text-3xl font-bold text-gray-800 mb-6 border-b pb-2">Contacter l'Enseignant</h2>
                <div class="bg-white p-6 rounded-xl shadow-lg mb-8">
                    <!-- Section de Profil et Contact -->
                    <div class="flex flex-col items-center text-center md:flex-row md:text-left md:items-start mb-8 border-b pb-6">
                        <!-- Photo Circulaire -->
                        <img src="${TEACHER_PHOTO_URL}" onerror="this.onerror=null; this.src='https://placehold.co/128x128/17a2b8/ffffff?text=Prof+Image'" alt="Photo de l'enseignant" class="w-32 h-32 rounded-full object-cover shadow-xl mb-4 md:mb-0 md:mr-6 border-4 border-teal-500">
                        
                        <!-- Info de Contact -->
                        <div>
                            <h3 class="text-2xl font-bold text-gray-800">Younes TICHOUA</h3>
                            <p class="text-gray-600 mb-2">Professeur d'Informatique</p>
                            <p class="text-lg font-semibold text-teal-700">Email: <a href="mailto:votre.email@ecole.com" class="hover:underline">votre.email@ecole.com</a></p>
                            <p class="text-sm text-gray-500 mt-2">Je m'efforce de répondre à vos courriels dans les 24 heures durant les jours de semaine.</p>
                        </div>
                    </div>
                    
                    <!-- Formulaire de Question Rapide (Formulaire Circulaire) -->
                    <div id="contact-form-container" class="bg-gray-50 p-6 rounded-xl shadow-inner border border-gray-200">
                        <h3 class="text-xl font-bold text-teal-700 mb-4">Envoyer une Question Rapide</h3>
                        <form onsubmit="handleContactSubmit(event)" class="space-y-4">
                            <div>
                                <label for="contact-subject" class="block text-sm font-medium text-gray-700">Sujet:</label>
                                <input type="text" id="contact-subject" placeholder="Ex: Problème avec le Quiz L1" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 focus:border-teal-500 focus:ring-teal-500">
                            </div>
                            <div>
                                <label for="contact-message" class="block text-sm font-medium text-gray-700">Votre Message:</label>
                                <textarea id="contact-message" rows="4" placeholder="Tapez votre question détaillée ici..." required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 focus:border-teal-500 focus:ring-teal-500"></textarea>
                            </div>
                            <button type="submit" class="w-full py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white gradient-theme hover:opacity-90 transition">
                                Envoyer le Message
                            </button>
                        </form>
                    </div>

                </div>
            `,
        };


        // --- Fonctions de Navigation et d'Initialisation ---

        // Met à jour la classe active dans la barre de navigation
        function updateNav(activeId) {
            const finalId = activeId.includes('sequence') ? 'modules' : activeId;
            
            const navLinks = document.querySelectorAll('.nav-links a');
            navLinks.forEach(link => {
                link.classList.remove('text-teal-700', 'font-extrabold', 'border-b-2', 'border-teal-700');
                if (link.id === `nav-${finalId}`) {
                    link.classList.add('text-teal-700', 'font-extrabold', 'border-b-2', 'border-teal-700');
                }
            });
        }

        // Fonction pour basculer l'état (déplié/replié) des modules dans la page modules
        function toggleModule(id) {
            const card = document.getElementById(`module-${id}`);
            if (card) {
                const isCollapsed = card.classList.toggle('collapsed');
                const icon = card.querySelector('.toggle-icon');
                if (icon) {
                    icon.innerHTML = isCollapsed ? '▶' : '▼';
                }
            }
        }
        
        // Navigation principale
        function navigateTo(pageName) {
            currentView = pageName;
            const container = document.getElementById('page-content-container');
            const contentGenerator = pageContent[pageName];

            if (contentGenerator) {
                container.innerHTML = contentGenerator();
            } else {
                if (lessonData[pageName]) {
                    container.innerHTML = generateLessonPage(pageName);
                } else {
                    container.innerHTML = `<div class="text-center p-12 text-gray-500">Page non trouvée : ${pageName}</div>`;
                }
            }

            updateNav(pageName);
            
            if (pageName === 'modules') {
                setTimeout(() => {
                    // Logique pour ouvrir M01 par défaut (le module "En cours")
                    const modulesToOpen = ['M01 : Généralités sur les Systèmes Informatiques']; 
                    
                    const moduleCards = document.querySelectorAll('.info-card');
                    moduleCards.forEach(card => {
                        const header = card.querySelector('.card-header h3');
                        const icon = card.querySelector('.toggle-icon');
                        
                        if (header && icon) {
                            if (modulesToOpen.some(title => header.textContent.includes(title))) {
                                card.classList.remove('collapsed');
                                icon.innerHTML = '▼';
                            } else {
                                card.classList.add('collapsed');
                                icon.innerHTML = '▶';
                            }
                        }
                    });
                }, 50); 
            }

            window.scrollTo(0, 0);
        }

        // CORRECTION DE L'ERREUR : Ajout de la fonction MapsTo pour qu'elle soit définie.
        // Elle agit comme un alias pour navigateTo, assurant que le code fonctionne 
        // même si l'utilisateur appelle accidentellement MapsTo.
        /**
         * Alias pour navigateTo pour corriger le ReferenceError.
         * @param {string} pageName - Le nom de la page ou de la leçon à afficher.
         */
        window.MapsTo = function(pageName) {
            console.warn("MapsTo() est obsolète. Utilisez navigateTo() à la place.");
            navigateTo(pageName);
        }
        
        // --- Initialisation au Chargement de la Page ---
        window.onload = () => {
            navigateTo(currentView);
            
            const userIdDisplay = document.querySelector('footer p:first-child');
            if (userIdDisplay) {
                // Ajout de l'ID utilisateur
                userIdDisplay.innerHTML += ` | ID: <span class="font-mono">${appId}</span>`;
            }
        };
        // Rendre la fonction accessible globalement pour le bouton dans le HTML
        window.toggleModule = toggleModule; 
    </script>
</body>
</html>
